<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø±ÙØ¹ ØªÙ‚Ø§Ø±ÙŠØ± ÙŠØ³ÙŠØ± | Ù…Ø¯Ø±Ø³Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800;900&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #1a3a5c;
    --accent: #c8973a;
    --accent-light: #f0b84a;
    --green: #1a6b4a;
    --green-light: #22a06b;
    --bg: #f5f2eb;
    --card: #ffffff;
    --border: #e0d8c8;
    --text: #1a1a2e;
    --muted: #5a6478;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Cairo',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; }

  header { background:linear-gradient(135deg,var(--primary) 0%,#0f2448 60%,#1a3a5c 100%); position:relative; }
  header::after { content:''; position:absolute; bottom:0; left:0; right:0; height:4px; background:linear-gradient(90deg,var(--accent),var(--accent-light),var(--accent)); }
  .header-top { display:flex; align-items:center; justify-content:space-between; padding:16px 40px; }
  .logo-wrap { display:flex; align-items:center; gap:14px; }
  .logo-icon { width:50px; height:50px; border-radius:50%; background:rgba(255,255,255,0.12); border:2px solid rgba(200,151,58,0.4); display:flex; align-items:center; justify-content:center; font-size:22px; }
  .header-name { color:rgba(255,255,255,0.9); font-size:0.83rem; font-weight:600; }
  .header-sub { color:rgba(255,255,255,0.5); font-size:0.75rem; }
  .back-link { background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:rgba(255,255,255,0.85); padding:7px 16px; border-radius:8px; text-decoration:none; font-size:0.82rem; font-weight:600; }
  .hero { padding:28px 40px 36px; text-align:center; }
  .hero-badge { display:inline-block; background:rgba(200,151,58,0.15); border:1px solid rgba(200,151,58,0.35); color:var(--accent-light); padding:5px 18px; border-radius:20px; font-size:0.8rem; font-weight:600; margin-bottom:12px; }
  .hero h1 { font-family:'Tajawal',sans-serif; font-size:clamp(1.5rem,4vw,2rem); font-weight:900; color:#fff; margin-bottom:6px; }
  .hero h1 span { color:var(--accent-light); }
  .hero p { color:rgba(255,255,255,0.6); font-size:0.85rem; }

  /* PIN */
  .pin-screen { display:flex; align-items:center; justify-content:center; min-height:60vh; padding:20px; }
  .pin-box { background:var(--card); border-radius:20px; padding:40px 32px; max-width:360px; width:100%; text-align:center; box-shadow:0 8px 40px rgba(0,0,0,0.1); }
  .pin-icon { font-size:2.6rem; margin-bottom:14px; }
  .pin-title { font-family:'Tajawal',sans-serif; font-size:1.3rem; font-weight:900; color:var(--primary); margin-bottom:6px; }
  .pin-desc { font-size:0.83rem; color:var(--muted); margin-bottom:22px; }
  .pin-input { width:100%; padding:13px; border:2px solid var(--border); border-radius:11px; font-family:'Cairo',sans-serif; font-size:1.3rem; font-weight:700; text-align:center; letter-spacing:8px; outline:none; transition:all 0.2s; background:#fafafa; margin-bottom:10px; }
  .pin-input:focus { border-color:var(--primary); background:#fff; }
  .pin-input.error { border-color:#ef4444; animation:shake 0.4s ease; }
  @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
  .pin-error { display:none; color:#dc2626; font-size:0.8rem; font-weight:700; margin-bottom:10px; background:#fee2e2; padding:7px 12px; border-radius:8px; }
  .pin-error.show { display:block; }
  .btn-enter { width:100%; padding:13px; background:linear-gradient(135deg,var(--primary),#2563a8); color:#fff; border:none; border-radius:10px; font-family:'Cairo',sans-serif; font-size:0.95rem; font-weight:800; cursor:pointer; }

  /* CONTENT */
  .content { display:none; }
  main { max-width:1000px; margin:0 auto; padding:26px 22px 60px; }

  /* Student Selector */
  .selector-card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:20px; margin-bottom:20px; box-shadow:0 2px 8px rgba(0,0,0,0.04); }
  .selector-title { font-size:0.9rem; font-weight:800; color:var(--primary); margin-bottom:12px; }
  .student-select { width:100%; padding:10px 14px; border:2px solid var(--border); border-radius:10px; font-family:'Cairo',sans-serif; font-size:0.9rem; font-weight:600; outline:none; background:#fafafa; color:var(--text); cursor:pointer; }
  .student-select:focus { border-color:var(--primary); }

  /* Upload Area */
  .upload-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:14px; }
  .upload-card { background:var(--card); border:1px solid var(--border); border-radius:14px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.04); transition:all 0.2s; }
  .upload-card:hover { box-shadow:0 4px 16px rgba(0,0,0,0.08); }
  .upload-head { padding:14px 16px; display:flex; align-items:center; gap:10px; border-bottom:1px solid var(--border); }
  .upload-icon { width:38px; height:38px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.1rem; flex-shrink:0; }
  .upload-title { font-size:0.85rem; font-weight:800; color:var(--primary); }
  .upload-filename { font-size:0.72rem; color:var(--muted); margin-top:2px; font-family:monospace; }
  .upload-body { padding:14px 16px; }

  .drop-zone { border:2px dashed var(--border); border-radius:10px; padding:20px; text-align:center; cursor:pointer; transition:all 0.2s; background:#fafafa; position:relative; }
  .drop-zone:hover, .drop-zone.dragover { border-color:var(--primary); background:#f0f4ff; }
  .drop-zone input[type=file] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
  .drop-icon { font-size:1.6rem; margin-bottom:6px; }
  .drop-text { font-size:0.78rem; color:var(--muted); font-weight:600; }
  .drop-sub { font-size:0.7rem; color:#9ca3af; margin-top:3px; }

  /* Status */
  .upload-status { margin-top:10px; font-size:0.78rem; font-weight:700; text-align:center; padding:6px 10px; border-radius:8px; display:none; }
  .status-uploading { background:#fef3c7; color:#92400e; display:flex; align-items:center; justify-content:center; gap:6px; }
  .status-success { background:#d1fae5; color:#065f46; }
  .status-error { background:#fee2e2; color:#dc2626; }
  .status-exists { background:#dbeafe; color:#1e40af; }

  /* File preview */
  .file-preview { margin-top:10px; padding:8px 12px; background:#f0f4ff; border-radius:8px; display:none; align-items:center; gap:8px; font-size:0.78rem; color:var(--primary); font-weight:600; }
  .file-preview .del-btn { margin-right:auto; background:#fee2e2; color:#dc2626; border:none; border-radius:6px; padding:3px 8px; font-size:0.72rem; cursor:pointer; font-family:'Cairo',sans-serif; font-weight:700; }

  .btn-upload { width:100%; padding:9px; background:linear-gradient(135deg,var(--green),var(--green-light)); color:#fff; border:none; border-radius:9px; font-family:'Cairo',sans-serif; font-size:0.82rem; font-weight:800; cursor:pointer; margin-top:10px; display:none; transition:all 0.2s; box-shadow:0 3px 10px rgba(26,107,74,0.25); }
  .btn-upload:hover { transform:translateY(-1px); }

  .progress-bar { height:4px; background:#e0d8c8; border-radius:2px; margin-top:8px; display:none; overflow:hidden; }
  .progress-fill { height:100%; background:linear-gradient(90deg,var(--green),var(--green-light)); border-radius:2px; transition:width 0.3s; width:0%; }
  .btn-delete { width:100%; padding:9px; background:#fee2e2; color:#dc2626; border:1px solid #fca5a5; border-radius:9px; font-family:'Cairo',sans-serif; font-size:0.82rem; font-weight:800; cursor:pointer; margin-top:6px; transition:all 0.2s; }
  .btn-delete:hover { background:#dc2626; color:#fff; }

  footer { background:var(--primary); color:rgba(255,255,255,0.6); text-align:center; padding:18px; font-size:0.78rem; border-top:3px solid var(--accent); }
  footer strong { color:var(--accent-light); }

  @media(max-width:640px) {
    .header-top { padding:12px 16px; }
    .hero { padding:22px 16px 28px; }
    main { padding:16px 14px 40px; }
  }
</style>
</head>
<body>

<header>
  <div class="header-top">
    <div class="logo-wrap">
      <div class="logo-icon">ğŸ“</div>
      <div>
        <div class="header-name">Ù…Ø¯Ø±Ø³Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</div>
        <div class="header-sub">Ù‚Ø³Ù… Ø°ÙˆÙŠ Ø§Ù„Ø¥Ø¹Ø§Ù‚Ø© â€” Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
      </div>
    </div>
    <a href="index.html" class="back-link">â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  </div>
  <div class="hero">
    <div class="hero-badge">ğŸ“˜ Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙŠØ³ÙŠØ±</div>
    <h1>Ø±ÙØ¹ <span>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø·Ù„Ø§Ø¨</span></h1>
    <p>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ Ø«Ù… Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Øª ØªÙ‚Ø§Ø±ÙŠØ±Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ</p>
  </div>
</header>

<!-- PIN -->
<div class="pin-screen" id="pin-screen">
  <div class="pin-box">
    <div class="pin-icon">ğŸ”</div>
    <div class="pin-title">ØµÙØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</div>
    <div class="pin-desc">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±Ù Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
    <input type="password" class="pin-input" id="admin-pin" maxlength="6" placeholder="â€¢ â€¢ â€¢ â€¢"
      onkeydown="if(event.key==='Enter') checkPin()"
      oninput="this.value=this.value.replace(/[^0-9]/g,'')">
    <div class="pin-error" id="pin-error">âŒ Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­</div>
    <button class="btn-enter" onclick="checkPin()">âœ… Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<!-- CONTENT -->
<div class="content" id="content">
  <main>
    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ -->
    <div class="selector-card">
      <div class="selector-title">ğŸ‘¤ Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨</div>
      <select class="student-select" id="student-select" onchange="loadStudentUploads()">
        <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ â€”</option>
        <option value="5271">Ø·Ù„Ø§Ù„ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø¹ØµÙ…Ø§Ù†ÙŠ â€” 5271</option>
        <option value="3955">Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù‚Ø§Ø¦Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù‡Ø±Ø§Ù†ÙŠ â€” 3955</option>
        <option value="3154">Ø¨Ø³Ø§Ù… Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ â€” 3154</option>
        <option value="3493">ÙˆØ³Ø§Ù… Ø¹ÙˆØ¶ Ø¨Ù† Ø´ÙŠÙ†Ø§Ù† Ø§Ù„Ø³Ù‡ÙŠÙ…ÙŠ â€” 3493</option>
        <option value="9055">Ø­Ø³Ù† ØµØ§Ù„Ø­ Ø­Ø³Ù† Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ â€” 9055</option>
        <option value="0962">Ø¥ÙŠØ§Ø¯ Ø®Ù„ÙŠÙ„ Ø·Ø§Ù‡Ø± Ù…ØµØ·ÙÙ‰ â€” 0962</option>
        <option value="4073">Ù…Ø­Ù…Ø¯ Ø¹Ù…Ø± Ù…Ø­Ù…Ø¯ Ø¨Ù„Ù‚Ø§Ø³Ù… Ø§Ù„Ø­Ø±Ø§Ø²ÙŠ â€” 4073</option>
        <option value="0788">Ø£Ù…Ø¬Ø¯ Ù…Ø±Ø²ÙˆÙ‚ Ø¹Ù„ÙŠ Ø§Ù„Ù…Ø­ÙˆØ±ÙŠ â€” 0788</option>
        <option value="8726">Ù…Ø±Ø§Ø¯ Ø¹Ù„ÙŠ Ø·Ù„Ù…ÙŠØ³ Ø§Ù„Ù…Ù†ØªØ´Ø±ÙŠ â€” 8726</option>
        <option value="2261">ÙÙŠØµÙ„ Ø­Ø§ØªÙ… Ø­Ø§Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ â€” 2261</option>
        <option value="9446">Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† ØªÙˆÙÙŠÙ‚ Ø¹Ù„ÙˆØ§Ù† Ù…Ù‚Ø±ÙŠ â€” 9446</option>
        <option value="7895">Ù…Ø­Ù…Ø¯ ÙØ§Ø±Ø³ ØµØ§Ù„Ø­ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ â€” 7895</option>
        <option value="5362">ÙˆØ³ÙŠÙ… Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø±Ø²Ù‚ÙŠ â€” 5362</option>
        <option value="2571">ÙØ§Ø±Ø³ Ù…Ø­Ù…Ø¯ Ù…Ø§Ù†Ø¹ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ â€” 2571</option>
        <option value="3590">Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø­Ø§Ù…Ø¯ Ø§Ù„Ù‡Ù„Ø§Ù„ÙŠ â€” 3590</option>
        <option value="8151">Ù…Ø³ÙØ± Ø­Ø³Ù† Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ â€” 8151</option>
        <option value="8061">Ù‡ØªØ§Ù† Ø¹Ø¨ÙŠØ¯Ø§Ù„Ù„Ù‡ Ø¬Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ù…Ø§Ø¯ÙŠ â€” 8061</option>
        <option value="5271">Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ ØºØ±Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù…Ø±Ø§Ù†ÙŠ â€” 5271</option>
        <option value="6812">Ù„ÙˆÙ‰ Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø±Ø²Ù‚ÙŠ â€” 6812</option>
        <option value="5237">Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø§Ø¬Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ â€” 5237</option>
      </select>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±ÙØ¹ -->
    <div class="upload-grid" id="upload-grid"></div>
  </main>
</div>

<footer>
  Â© 1447Ù‡Ù€ Ù…Ø¯Ø±Ø³Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© â€” Ù‚Ø³Ù… Ø°ÙˆÙŠ Ø§Ù„Ø¥Ø¹Ø§Ù‚Ø©<br>
  <strong>Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ°: Ø£. Ø³Ø¹Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</strong>
</footer>

<script>
const SUPABASE_URL = "https://pyrxwqgapwjwhiskowhk.supabase.co";
const SUPABASE_KEY = "sb_publishable_bfe-B4f-Rag1SR0-PoIb9w_nMfA1Ere";
const BUCKET = "reports";
const ADMIN_PIN = "1129";

const REPORT_TYPES = [
  { key: "plan",    label: "ğŸ“‹ Ø§Ù„Ø®Ø·Ø© Ø§Ù„ÙØ±Ø¯ÙŠØ©",        icon: "ğŸ“‹", color: "#fff3e0" },
  { key: "psych",   label: "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ÙØ³ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯",   icon: "ğŸ§ ", color: "#ede9fe" },
  { key: "medical", label: "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠ",            icon: "ğŸ¥", color: "#dbeafe" },
  { key: "report1", label: "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù¡",         icon: "ğŸ“„", color: "#fef3c7" },
  { key: "report2", label: "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù¢",         icon: "ğŸ“Š", color: "#d1fae5" },
  { key: "report3", label: "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù£",         icon: "ğŸ“‹", color: "#ede9fe" },
];

let selectedFiles = {};

function checkPin() {
  const val = document.getElementById('admin-pin').value;
  if (val === ADMIN_PIN) {
    document.getElementById('pin-screen').style.display = 'none';
    document.getElementById('content').style.display = 'block';
  } else {
    const err = document.getElementById('pin-error');
    const inp = document.getElementById('admin-pin');
    err.classList.add('show');
    inp.classList.add('error');
    inp.value = '';
    setTimeout(() => inp.classList.remove('error'), 500);
  }
}

function loadStudentUploads() {
  const pin = document.getElementById('student-select').value;
  const grid = document.getElementById('upload-grid');
  if (!pin) { grid.innerHTML = ''; return; }

  selectedFiles = {};
  grid.innerHTML = REPORT_TYPES.map(r => `
    <div class="upload-card" id="card-${r.key}">
      <div class="upload-head">
        <div class="upload-icon" style="background:${r.color}">${r.icon}</div>
        <div>
          <div class="upload-title">${r.label}</div>
          <div class="upload-filename" id="fname-${r.key}">${r.key}-${pin}.pdf</div>
        </div>
      </div>
      <div class="upload-body">
        <div class="drop-zone" id="drop-${r.key}"
          ondragover="event.preventDefault();this.classList.add('dragover')"
          ondragleave="this.classList.remove('dragover')"
          ondrop="handleDrop(event,'${r.key}','${pin}')">
          <input type="file" accept=".pdf,.doc,.docx,.jpg,.png" onchange="handleFile(this,'${r.key}','${pin}')">
          <div class="drop-icon">ğŸ“‚</div>
          <div class="drop-text">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡ Ù‡Ù†Ø§</div>
          <div class="drop-sub">PDF, Word, ØµÙˆØ±</div>
        </div>
        <div class="file-preview" id="preview-${r.key}">
          <span>ğŸ“</span>
          <span id="preview-name-${r.key}"></span>
          <button class="del-btn" onclick="clearFile('${r.key}')">âœ• Ø¥Ù„ØºØ§Ø¡</button>
        </div>
        <div class="progress-bar" id="progress-${r.key}">
          <div class="progress-fill" id="progress-fill-${r.key}"></div>
        </div>
        <div class="upload-status" id="status-${r.key}"></div>
        <button class="btn-upload" id="btn-${r.key}" onclick="uploadFile('${r.key}','${pin}')">
          â¬†ï¸ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
        </button>
        <button class="btn-delete" id="del-btn-${r.key}" onclick="deleteFile('${r.key}','${pin}')" style="display:none;">
          ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙˆØ¹
        </button>
      </div>
    </div>
  `).join('');

  // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
  checkExistingFiles(pin);
}

async function checkExistingFiles(pin) {
  const extensions = ['pdf', 'PDF', 'docx', 'doc', 'jpg', 'png'];
  for (const r of REPORT_TYPES) {
    for (const ext of extensions) {
      try {
        const fileName = `${r.key}-${pin}.${ext}`;
        const url = `${SUPABASE_URL}/storage/v1/object/public/${BUCKET}/${fileName}`;
        const res = await fetch(url, { method: 'HEAD' });
        if (res.ok) {
          showStatus(r.key, 'exists', `âœ… ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ù…Ø±ÙÙˆØ¹ â€” ${fileName}`);
          document.getElementById(`del-btn-${r.key}`).style.display = 'block';
          document.getElementById(`fname-${r.key}`).textContent = fileName;
          // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
          document.getElementById(`preview-name-${r.key}`).textContent = fileName;
          document.getElementById(`preview-${r.key}`).style.display = 'flex';
          break;
        }
      } catch(e) {}
    }
  }
}

function handleFile(input, key, pin) {
  const file = input.files[0];
  if (!file) return;
  selectedFiles[key] = file;
  showPreview(key, file.name, pin);
}

function handleDrop(e, key, pin) {
  e.preventDefault();
  document.getElementById(`drop-${key}`).classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (!file) return;
  selectedFiles[key] = file;
  showPreview(key, file.name, pin);
}

function showPreview(key, name, pin) {
  document.getElementById(`preview-name-${key}`).textContent = name;
  document.getElementById(`preview-${key}`).style.display = 'flex';
  document.getElementById(`btn-${key}`).style.display = 'block';
  document.getElementById(`status-${key}`).style.display = 'none';
}

function clearFile(key) {
  delete selectedFiles[key];
  document.getElementById(`preview-${key}`).style.display = 'none';
  document.getElementById(`btn-${key}`).style.display = 'none';
  document.getElementById(`status-${key}`).style.display = 'none';
  document.getElementById(`progress-${key}`).style.display = 'none';
}

async function uploadFile(key, pin) {
  const file = selectedFiles[key];
  if (!file) return;

  const ext = file.name.split('.').pop();
  const fileName = `${key}-${pin}.${ext}`;

  const btn = document.getElementById(`btn-${key}`);
  btn.disabled = true;
  btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';

  showStatus(key, 'uploading', 'â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù...');
  document.getElementById(`progress-${key}`).style.display = 'block';

  // Simulate progress
  let prog = 0;
  const interval = setInterval(() => {
    prog = Math.min(prog + 10, 85);
    document.getElementById(`progress-fill-${key}`).style.width = prog + '%';
  }, 200);

  try {
    const res = await fetch(`${SUPABASE_URL}/storage/v1/object/${BUCKET}/${fileName}`, {
      method: 'POST',
      headers: {
        'apikey': SUPABASE_KEY,
        'Authorization': 'Bearer ' + SUPABASE_KEY,
        'Content-Type': file.type || 'application/octet-stream',
        'x-upsert': 'true'
      },
      body: file
    });

    clearInterval(interval);
    document.getElementById(`progress-fill-${key}`).style.width = '100%';

    if (res.ok) {
      showStatus(key, 'success', `âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­ â€” ${fileName}`);
      document.getElementById(`fname-${key}`).textContent = fileName;
      btn.textContent = 'âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹';
      document.getElementById(`del-btn-${key}`).style.display = 'block';
    } else {
      const err = await res.text();
      showStatus(key, 'error', 'âŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹ â€” Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
      btn.textContent = 'â¬†ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©';
      btn.disabled = false;
    }
  } catch(e) {
    clearInterval(interval);
    showStatus(key, 'error', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
    btn.textContent = 'â¬†ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©';
    btn.disabled = false;
  }
}

async function deleteFile(key, pin) {
  if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù…Ù„Ù "${key}-${pin}" Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ`)) return;

  const extensions = ['pdf', 'PDF', 'docx', 'doc', 'jpg', 'png'];
  let deleted = false;

  for (const ext of extensions) {
    const fileName = `${key}-${pin}.${ext}`;
    try {
      const res = await fetch(`${SUPABASE_URL}/storage/v1/object/${BUCKET}/${fileName}`, {
        method: 'DELETE',
        headers: {
          'apikey': SUPABASE_KEY,
          'Authorization': 'Bearer ' + SUPABASE_KEY
        }
      });
      if (res.ok) {
        deleted = true;
        showStatus(key, 'error', 'ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­');
        document.getElementById(`del-btn-${key}`).style.display = 'none';
        document.getElementById(`fname-${key}`).textContent = `${key}-${pin}.pdf`;
        clearFile(key);
        break;
      }
    } catch(e) {}
  }

  if (!deleted) showStatus(key, 'error', 'âŒ Ù„Ù… ÙŠÙØ¹Ø«Ø± Ø¹Ù„Ù‰ Ù…Ù„Ù Ù„Ù„Ø­Ø°Ù');
}

function showStatus(key, type, msg) {
  const el = document.getElementById(`status-${key}`);
  el.style.display = 'block';
  el.className = `upload-status status-${type}`;
  el.textContent = msg;
}
</script>
</body>
</html>
