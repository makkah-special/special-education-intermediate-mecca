<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© ÙØµÙˆÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… â€“ ØªØ´Ø®ÙŠØµ Ø·Ù„Ø§Ø¨ ÙŠØ³ÙŠØ± | Ù…Ø¯Ø±Ø³Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</title>
  <meta name="description" content="Ù„ÙˆØ­Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„ÙØµÙˆÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… Ù„ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø§Ø¨ ÙŠØ³ÙŠØ± ÙˆØ¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ´Ø®ÙŠØµ Ù…Ø¹ ÙˆØ¶Ø¹ Ø¹Ø±Ø¶ ÙÙ‚Ø· Ù„Ù„Ø²ÙˆØ§Ø± ÙˆÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø­Ù…ÙŠ." />

  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.10);
      --text:#eaf2ff;
      --muted:rgba(234,242,255,.72);
      --shadow:0 18px 60px rgba(0,0,0,.35);
      --radius:22px;

      --green: rgba(34,197,94,.95);
      --gray: rgba(148,163,184,.85);
      --blue: rgba(59,130,246,.90);
      --amber: rgba(245,158,11,.95);
      --purple: rgba(124,92,255,.95);

      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Tajawal", Tahoma, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1200px 500px at 20% 10%, rgba(59,130,246,.25), transparent 60%),
        radial-gradient(1000px 600px at 80% 0%, rgba(34,197,94,.18), transparent 55%),
        linear-gradient(160deg, #0b1220, #071022);
      min-height:100vh;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1180px;margin:0 auto;padding:22px 16px 34px}

    /* Top */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:56px;height:56px;border-radius:16px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      display:grid;place-items:center;overflow:hidden;
      box-shadow:var(--shadow);
    }
    .logo img{width:100%;height:100%;object-fit:contain;padding:10px}
    .title{margin:0;font-size:18px;line-height:1.4}
    .sub{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.7}

    /* Buttons */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:10px 14px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: linear-gradient(135deg, rgba(59,130,246,.28), rgba(124,92,255,.18));
      color:var(--text);
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .btn.secondary{background: rgba(255,255,255,.06)}
    .btn.danger{background: rgba(239,68,68,.18)}

    /* Panel */
    .panel{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      overflow:hidden;
    }
    .panelHead{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .panelHead h1{margin:0;font-size:18px}
    .panelHead p{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.7}

    /* Admin */
    .adminBar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      padding:12px;
      border-radius:18px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      margin-bottom:12px;
    }
    .modeTag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      font-weight:900;
      font-size:12px;
      color:rgba(234,242,255,.88);
    }
    .hint{color:var(--muted);font-size:12.5px;line-height:1.7}

    /* KPIs */
    .summary{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
      margin-bottom:12px;
    }
    .kpi{
      grid-column: span 4;
      background: rgba(0,0,0,.10);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .kpi .num{font-size:24px;font-weight:1000;line-height:1}
    .kpi .lab{color:var(--muted);font-size:13px;line-height:1.6}
    .kpi .ic{
      width:42px;height:42px;border-radius:14px;
      display:grid;place-items:center;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      font-size:20px;
      flex:0 0 auto;
    }
    .kpi.blue .num{color:var(--blue)}
    .kpi.green .num{color:var(--green)}
    .kpi.amber .num{color:var(--amber)}
    .kpi.purple .num{color:var(--purple)}
    @media (max-width: 980px){ .kpi{grid-column: span 6;} }
    @media (max-width: 560px){ .kpi{grid-column: span 12;} }

    /* Table */
    .tableWrap{
      border:1px solid var(--stroke);
      border-radius: 18px;
      overflow:hidden;
      background:rgba(0,0,0,.10);
    }
    table{width:100%;border-collapse:collapse;font-size:13px}
    thead th{
      text-align:right;
      padding:12px 10px;
      background:rgba(255,255,255,.05);
      border-bottom:1px solid var(--stroke);
      color: rgba(234,242,255,.92);
      font-weight:1000;
      white-space:nowrap;
    }
    tbody td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      vertical-align:middle;
    }
    tbody tr:hover td{background:rgba(255,255,255,.03)}
    .numCell{ text-align:center; font-weight:1000; }

    input[type="number"], input[type="text"], select{
      width:100%;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--text);
      outline:none;
      font-weight:900;
      font-size:13px;
    }
    input[type="number"]{text-align:center}
    input[disabled], select[disabled]{opacity:.65;cursor:not-allowed}

    .statusPill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      font-weight:1000;
      font-size:12px;
      min-width:120px;
      white-space:nowrap;
    }
    .statusGreen{ background: rgba(34,197,94,.14); color: rgba(219,255,235,.95); border-color: rgba(34,197,94,.30); }
    .statusGray{ background: rgba(148,163,184,.10); color: rgba(234,242,255,.80); border-color: rgba(148,163,184,.25); }

    .footer{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color: rgba(234,242,255,.55);
      font-size:12px;
      line-height:1.8;
    }
    .note{
      margin-top:10px;
      color: rgba(234,242,255,.65);
      font-size:12.5px;
      line-height:1.8;
      padding:12px;
      border-radius:18px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="brand">
        <div class="logo" title="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
          <img src="school-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
        </div>
        <div>
          <h2 class="title">Ù„ÙˆØ­Ø© ÙØµÙˆÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… â€“ ØªØ´Ø®ÙŠØµ Ø·Ù„Ø§Ø¨ ÙŠØ³ÙŠØ±</h2>
          <p class="sub">Ø¹Ø±Ø¶ ÙÙ‚Ø· Ù„Ù„Ø²ÙˆØ§Ø± â€” Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</p>
        </div>
      </div>

      <a class="btn secondary" href="index.html">â¬…ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>

    <section class="panel">
      <div class="panelHead">
        <div>
          <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h1>
          <p>Ø³Ø¬Ù‘Ù„ Ø¹Ø¯Ø¯ Ø·Ù„Ø§Ø¨ ÙŠØ³ÙŠØ± + Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ´Ø®ÙŠØµ + Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø§Ø¨ Ø§Ù„ÙØµÙ„. (Ø§Ù„Ø­Ø§Ù„Ø© ØªØªØ­ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø£Ø®Ø¶Ø±/Ø±Ù…Ø§Ø¯ÙŠ)</p>
        </div>
      </div>

      <!-- Admin Bar -->
      <div class="adminBar">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <span class="modeTag" id="modeTag">ğŸ”’ Ø§Ù„ÙˆØ¶Ø¹: Ø¹Ø±Ø¶ ÙÙ‚Ø·</span>
          <span class="hint" id="saveHint">ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø².</span>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <button class="btn" id="unlockBtn">ğŸ”‘ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn secondary" id="lockBtn" style="display:none;">âœ… Ù‚ÙÙ„ Ø§Ù„Ù„ÙˆØ­Ø©</button>
          <button class="btn danger" id="resetBtn" style="display:none;">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
      </div>

      <!-- KPIs (Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§) -->
      <div class="summary" aria-label="Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">
        <div class="kpi blue">
          <div>
            <div class="num" id="kpiClasses">0</div>
            <div class="lab">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØµÙˆÙ„</div>
          </div>
          <div class="ic">ğŸ«</div>
        </div>

        <div class="kpi green">
          <div>
            <div class="num" id="kpiClassesWithYaseer">0</div>
            <div class="lab">ÙØµÙˆÙ„ ÙŠÙˆØ¬Ø¯ ÙÙŠÙ‡Ø§ Ø·Ù„Ø§Ø¨ ÙŠØ³ÙŠØ±</div>
          </div>
          <div class="ic">ğŸŸ¢</div>
        </div>

        <div class="kpi purple">
          <div>
            <div class="num" id="kpiYaseer">0</div>
            <div class="lab">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø§Ø¨ ÙŠØ³ÙŠØ±</div>
          </div>
          <div class="ic">ğŸ“˜</div>
        </div>

        <div class="kpi amber">
          <div>
            <div class="num" id="kpiPending">0</div>
            <div class="lab">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ´Ø®ÙŠØµ</div>
          </div>
          <div class="ic">â³</div>
        </div>

        <div class="kpi blue">
          <div>
            <div class="num" id="kpiTotalStudents">0</div>
            <div class="lab">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø§Ø¨ Ø§Ù„ÙØµÙˆÙ„ (Ø­Ø³Ø¨ Ø¥Ø¯Ø®Ø§Ù„Ùƒ)</div>
          </div>
          <div class="ic">ğŸ‘¥</div>
        </div>

        <div class="kpi purple">
          <div>
            <div class="num" id="kpiAllYaseerPending">0</div>
            <div class="lab">Ø¥Ø¬Ù…Ø§Ù„ÙŠ (ÙŠØ³ÙŠØ± + Ø§Ù†ØªØ¸Ø§Ø±)</div>
          </div>
          <div class="ic">ğŸ“Œ</div>
        </div>
      </div>

      <!-- Table -->
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>Ø§Ù„ÙØµÙ„</th>
              <th>Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
              <th>Ø§Ù„ØµÙ</th>
              <th class="numCell">Ø·Ù„Ø§Ø¨ ÙŠØ³ÙŠØ±</th>
              <th class="numCell">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ´Ø®ÙŠØµ</th>
              <th class="numCell">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø§Ø¨ Ø§Ù„ÙØµÙ„</th>
              <th class="numCell">Ø§Ù„Ø­Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div class="note">
        âœ… <b>ØªÙ†Ø¨ÙŠÙ‡:</b> Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù‡Ù†Ø§ ØªÙ…Ù†Ø¹ Ø§Ù„Ø¹Ø¨Ø« Ù„Ù„Ø²ÙˆØ§Ø± (Ø¹Ø±Ø¶ ÙÙ‚Ø·). Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§ÙØªØ­ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø«Ù… <b>Ø§Ù‚ÙÙ„ Ø§Ù„Ù„ÙˆØ­Ø©</b> Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡.
      </div>

      <div class="footer">
        <div>Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ°: Ø£. Ø³Ø¹Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</div>
        <div>Â© <span id="y"></span> Ù…Ø¯Ø±Ø³Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© â€” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù…</div>
      </div>
    </section>

  </div>

  <script>
    /* ===============================
       1) ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (ØºÙŠÙ‘Ø±Ù‡Ø§ Ø§Ù„Ø¢Ù†)
       =============================== */
    const ADMIN_PASS = "Saadzh99";

    /* ===============================
       2) Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
       =============================== */
    const STORAGE_KEY = "makkah_special_general_yaseer_v2";

    /* ===============================
       3) ØªÙˆÙ„ÙŠØ¯ ØµÙÙˆÙ Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
          Ù¡/Ù¡..Ù¨/Ù¡ + Ù¢/Ù¢..Ù¨/Ù¢ + Ù£/Ù£..Ù¨/Ù£
       =============================== */
    function makeClassRows(){
      const rows = [];
      const groups = [
        { grade:"Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·", prefix:"1" },
        { grade:"Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·", prefix:"2" },
        { grade:"Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·", prefix:"3" },
      ];

      // Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ù…Ù† 1..8 Ù„ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©
      for(const g of groups){
        for(let n=1; n<=8; n++){
          rows.push({
            cls: `${g.prefix}/${n}`,
            building: "Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",
            grade: g.grade,
            yaseer: 0,
            pending: 0,
            totalStudents: 0
          });
        }
      }
      return rows;
    }

    const BUILDINGS = ["Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ","Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠ","Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"];
    const GRADES = ["Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·","Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·","Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·"];

    const els = {
      tbody: document.getElementById("tbody"),
      modeTag: document.getElementById("modeTag"),
      unlockBtn: document.getElementById("unlockBtn"),
      lockBtn: document.getElementById("lockBtn"),
      resetBtn: document.getElementById("resetBtn"),

      kpiClasses: document.getElementById("kpiClasses"),
      kpiClassesWithYaseer: document.getElementById("kpiClassesWithYaseer"),
      kpiYaseer: document.getElementById("kpiYaseer"),
      kpiPending: document.getElementById("kpiPending"),
      kpiTotalStudents: document.getElementById("kpiTotalStudents"),
      kpiAllYaseerPending: document.getElementById("kpiAllYaseerPending"),
    };

    document.getElementById("y").textContent = new Date().getFullYear();

    let editMode = false;
    let data = loadData();

    function num(v){
      const n = Number(v);
      if(!Number.isFinite(n) || n < 0) return 0;
      return Math.floor(n);
    }

    function loadData(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return makeClassRows();
        const parsed = JSON.parse(raw);
        if(!Array.isArray(parsed) || parsed.length === 0) return makeClassRows();

        // ØªØ·Ø¨ÙŠØ¹ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù†ÙØ³ ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        const base = makeClassRows();
        const map = new Map(parsed.map(r=>[String(r.cls).trim(), r]));

        return base.map(r=>{
          const old = map.get(r.cls);
          if(!old) return r;
          return {
            cls: r.cls,
            building: BUILDINGS.includes(old.building) ? old.building : r.building,
            grade: GRADES.includes(old.grade) ? old.grade : r.grade,
            yaseer: num(old.yaseer),
            pending: num(old.pending),
            totalStudents: num(old.totalStudents),
          };
        });
      }catch(e){
        return makeClassRows();
      }
    }

    function saveData(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function statusInfo(row){
      const has = num(row.yaseer) > 0;
      return {
        text: has ? "ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙŠØ³ÙŠØ±" : "Ù„Ø§ ÙŠÙˆØ¬Ø¯",
        cls: has ? "statusGreen" : "statusGray"
      };
    }

    function makeSelect(options, value, disabled){
      const sel = document.createElement("select");
      options.forEach(opt=>{
        const o = document.createElement("option");
        o.value = opt;
        o.textContent = opt;
        if(opt === value) o.selected = true;
        sel.appendChild(o);
      });
      sel.disabled = disabled;
      return sel;
    }

    function render(){
      els.tbody.innerHTML = "";

      data.forEach((row, idx)=>{
        const tr = document.createElement("tr");

        // 1) Ø§Ù„ÙØµÙ„ (Ø«Ø§Ø¨Øª)
        const tdClass = document.createElement("td");
        tdClass.textContent = row.cls;
        tdClass.style.fontWeight = "1000";
        tdClass.style.whiteSpace = "nowrap";

        // 2) Ø§Ù„Ù…Ø¨Ù†Ù‰
        const tdBuilding = document.createElement("td");
        const buildingSel = makeSelect(BUILDINGS, row.building, !editMode);
        buildingSel.addEventListener("change", ()=>{
          data[idx].building = buildingSel.value;
          saveData();
        });
        tdBuilding.appendChild(buildingSel);

        // 3) Ø§Ù„ØµÙ
        const tdGrade = document.createElement("td");
        const gradeSel = makeSelect(GRADES, row.grade, !editMode);
        gradeSel.addEventListener("change", ()=>{
          data[idx].grade = gradeSel.value;
          saveData();
        });
        tdGrade.appendChild(gradeSel);

        // 4) ÙŠØ³ÙŠØ±
        const tdY = document.createElement("td");
        tdY.className = "numCell";
        const yInput = document.createElement("input");
        yInput.type = "number";
        yInput.min = "0";
        yInput.value = row.yaseer;
        yInput.disabled = !editMode;
        yInput.addEventListener("input", ()=>{
          data[idx].yaseer = num(yInput.value);
          yInput.value = data[idx].yaseer;
          saveData();
          updateKPIs();
          updateStatus(tr, idx);
        });
        tdY.appendChild(yInput);

        // 5) Ø§Ù†ØªØ¸Ø§Ø±
        const tdP = document.createElement("td");
        tdP.className = "numCell";
        const pInput = document.createElement("input");
        pInput.type = "number";
        pInput.min = "0";
        pInput.value = row.pending;
        pInput.disabled = !editMode;
        pInput.addEventListener("input", ()=>{
          data[idx].pending = num(pInput.value);
          pInput.value = data[idx].pending;
          saveData();
          updateKPIs();
        });
        tdP.appendChild(pInput);

        // 6) Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø§Ø¨ Ø§Ù„ÙØµÙ„ (ÙŠØ¯ÙˆÙŠ)
        const tdT = document.createElement("td");
        tdT.className = "numCell";
        const tInput = document.createElement("input");
        tInput.type = "number";
        tInput.min = "0";
        tInput.value = row.totalStudents;
        tInput.disabled = !editMode;
        tInput.addEventListener("input", ()=>{
          data[idx].totalStudents = num(tInput.value);
          tInput.value = data[idx].totalStudents;
          saveData();
          updateKPIs();
        });
        tdT.appendChild(tInput);

        // 7) Ø§Ù„Ø­Ø§Ù„Ø©
        const tdS = document.createElement("td");
        tdS.className = "numCell";
        const pill = document.createElement("span");
        const st = statusInfo(row);
        pill.className = `statusPill ${st.cls}`;
        pill.textContent = st.text;
        tdS.appendChild(pill);

        tr.appendChild(tdClass);
        tr.appendChild(tdBuilding);
        tr.appendChild(tdGrade);
        tr.appendChild(tdY);
        tr.appendChild(tdP);
        tr.appendChild(tdT);
        tr.appendChild(tdS);

        els.tbody.appendChild(tr);
      });

      updateKPIs();
      updateModeUI();
    }

    function updateStatus(tr, idx){
      const pill = tr.querySelector(".statusPill");
      if(!pill) return;
      const st = statusInfo(data[idx]);
      pill.className = `statusPill ${st.cls}`;
      pill.textContent = st.text;
    }

    function updateKPIs(){
      const totalClasses = data.length;
      const totalYaseer = data.reduce((a,r)=>a + num(r.yaseer), 0);
      const totalPending = data.reduce((a,r)=>a + num(r.pending), 0);
      const totalStudents = data.reduce((a,r)=>a + num(r.totalStudents), 0);
      const classesWithYaseer = data.reduce((a,r)=>a + (num(r.yaseer) > 0 ? 1 : 0), 0);

      els.kpiClasses.textContent = String(totalClasses);
      els.kpiClassesWithYaseer.textContent = String(classesWithYaseer);
      els.kpiYaseer.textContent = String(totalYaseer);
      els.kpiPending.textContent = String(totalPending);
      els.kpiTotalStudents.textContent = String(totalStudents);
      els.kpiAllYaseerPending.textContent = String(totalYaseer + totalPending);
    }

    function updateModeUI(){
      els.modeTag.textContent = editMode ? "ğŸ”“ Ø§Ù„ÙˆØ¶Ø¹: ØªØ¹Ø¯ÙŠÙ„" : "ğŸ”’ Ø§Ù„ÙˆØ¶Ø¹: Ø¹Ø±Ø¶ ÙÙ‚Ø·";
      els.unlockBtn.style.display = editMode ? "none" : "";
      els.lockBtn.style.display = editMode ? "" : "none";
      els.resetBtn.style.display = editMode ? "" : "none";

      // ØªÙ…ÙƒÙŠÙ†/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„
      document.querySelectorAll("input, select").forEach(el=>{
        el.disabled = !editMode;
      });
    }

    els.unlockBtn.addEventListener("click", ()=>{
      const p = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:");
      if(p === null) return;
      if(p === ADMIN_PASS){
        editMode = true;
        render();
      }else{
        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");
      }
    });

    els.lockBtn.addEventListener("click", ()=>{
      editMode = false;
      render();
      alert("ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ù„ÙˆØ­Ø© (Ø¹Ø±Ø¶ ÙÙ‚Ø·).");
    });

    els.resetBtn.addEventListener("click", ()=>{
      const ok = confirm("ØªØ£ÙƒÙŠØ¯: Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ (Ø³ÙŠØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)");
      if(!ok) return;
      data = makeClassRows();
      saveData();
      render();
    });

    // ØªØ´ØºÙŠÙ„
    render();
  </script>
</body>
</html>
