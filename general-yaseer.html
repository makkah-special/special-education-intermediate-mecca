<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>لوحة فصول التعليم العام — تشخيص طلاب يسير</title>
  <meta name="description" content="لوحة تفاعلية لفصول التعليم العام وتشخيص طلاب يسير" />

  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#0a1a2b;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.10);
      --text:#eaf2ff;
      --muted:rgba(234,242,255,.70);
      --good:#22c55e;
      --gray:#94a3b8;
      --shadow:0 18px 60px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      color:var(--text);
      background: radial-gradient(1200px 500px at 20% 10%, rgba(59,130,246,.25), transparent 60%),
                  radial-gradient(1000px 600px at 80% 0%, rgba(34,197,94,.18), transparent 55%),
                  linear-gradient(160deg,var(--bg1),var(--bg2));
      min-height:100vh;
    }
    header{
      padding:22px 16px 10px;
      max-width:1200px;
      margin:0 auto;
    }
    h1{
      margin:0 0 10px;
      font-size:20px;
      line-height:1.4;
    }
    .sub{
      color:var(--muted);
      margin:0 0 14px;
      font-size:13px;
      line-height:1.7;
    }

    .topbar{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
      margin:12px 0 16px;
    }
    .btn{
      border:1px solid var(--stroke);
      background:linear-gradient(135deg, rgba(59,130,246,.25), rgba(34,197,94,.18));
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      box-shadow: var(--shadow);
      font-weight:900;
      font-size:13px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn.secondary{
      background: rgba(255,255,255,.06);
      box-shadow:none;
    }
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:0 16px 26px;
    }
    .cards{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap:12px;
      margin:12px 0 18px;
    }
    @media (max-width: 980px){ .cards{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 520px){ .cards{grid-template-columns: 1fr;} }

    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:14px 14px;
      box-shadow: var(--shadow);
    }
    .k{color:var(--muted); font-size:12px; margin-bottom:6px}
    .v{font-size:22px; font-weight:1000}

    .filters{
      display:flex; flex-wrap:wrap; gap:10px;
      align-items:center;
      margin: 6px 0 12px;
    }
    select, input[type="text"], input[type="number"]{
      background: rgba(255,255,255,.06);
      border: 1px solid var(--stroke);
      color: var(--text);
      padding:10px 12px;
      border-radius: 14px;
      outline:none;
      font-weight:800;
      font-size:13px;
    }
    select{cursor:pointer}
    input::placeholder{color: rgba(234,242,255,.55)}

    .tableWrap{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    thead th{
      text-align:right;
      padding:12px 12px;
      color:var(--muted);
      background: rgba(255,255,255,.03);
      border-bottom:1px solid var(--stroke);
      position:sticky;
      top:0;
      z-index:2;
    }
    tbody td{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      vertical-align:middle;
    }
    tbody tr:hover{ background: rgba(255,255,255,.03); }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:7px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      font-weight:900;
      font-size:12px;
      white-space:nowrap;
    }
    .dot{
      width:9px; height:9px; border-radius:50%;
      background: var(--gray);
      box-shadow: 0 0 0 3px rgba(148,163,184,.12);
    }
    tr.hasYaseer .dot{ background: var(--good); box-shadow:0 0 0 3px rgba(34,197,94,.18); }
    tr.hasYaseer .badge{ border-color: rgba(34,197,94,.35); }
    tr.noYaseer .badge{ border-color: rgba(148,163,184,.35); color: rgba(234,242,255,.78); }

    .cellInput{ width: 92px; max-width: 120px; }

    .footer{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
    }
    @media (max-width: 980px){ .footer{grid-template-columns:1fr;} }

    .miniTitle{
      margin:0 0 10px;
      color:var(--muted);
      font-size:13px;
      font-weight:1000;
    }
    .list{ display:flex; flex-direction:column; gap:8px; }
    .row{
      display:flex; justify-content:space-between; gap:10px;
      padding:10px 12px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.06);
      border-radius: 14px;
      font-weight:900;
    }
    .row span:first-child{color:rgba(234,242,255,.85)}
    .row span:last-child{color:var(--text); font-weight:1000}

    .note{
      margin-top:12px;
      color:rgba(234,242,255,.55);
      font-size:12px;
      line-height:1.7;
    }
    .tiny{
      color:rgba(234,242,255,.55);
      font-size:12px;
      margin-top:10px;
      text-align:center;
    }
  </style>
</head>

<body>
  <header>
    <h1>لوحة فصول التعليم العام — تشخيص طلاب يسير</h1>
    <p class="sub">عدّل الأرقام داخل الجدول، ثم اضغط “تحديث البيانات” عشان الإحصائيات فوق وتحت تتحدث بدقة.</p>

    <div class="topbar">
      <a class="btn secondary" href="index.html">⬅️ رجوع للرئيسية</a>
      <button class="btn" id="btnRefresh">تحديث البيانات</button>
      <button class="btn secondary" id="btnReset">إعادة ضبط (يمسح أرقامك)</button>
    </div>
  </header>

  <main class="wrap">

    <section class="cards" aria-label="إحصائيات أعلى الصفحة">
      <div class="card">
        <div class="k">عدد الفصول</div>
        <div class="v" id="statClasses">—</div>
      </div>
      <div class="card">
        <div class="k">مجموع طلاب يسير</div>
        <div class="v" id="statYaseer">—</div>
      </div>
      <div class="card">
        <div class="k">بانتظار التشخيص</div>
        <div class="v" id="statPending">—</div>
      </div>
      <div class="card">
        <div class="k">إجمالي طلاب الفصول</div>
        <div class="v" id="statTotal">—</div>
      </div>
    </section>

    <section class="filters" aria-label="فلاتر">
      <select id="filterBuilding">
        <option value="all">كل المباني</option>
        <option value="الشمالي">المبنى الشمالي</option>
        <option value="الجنوبي">المبنى الجنوبي</option>
        <option value="الرئيسي">المبنى الرئيسي</option>
      </select>

      <select id="filterGrade">
        <option value="all">كل الصفوف</option>
        <option value="أول متوسط">أول متوسط</option>
        <option value="ثاني متوسط">ثاني متوسط</option>
        <option value="ثالث متوسط">ثالث متوسط</option>
      </select>

      <select id="filterHasYaseer">
        <option value="all">كل الحالات</option>
        <option value="has">يوجد يسير</option>
        <option value="none">لا يوجد</option>
      </select>

      <input id="searchBox" type="text" placeholder="بحث (مثال: ٣/٥ أو الرئيسي)" />
    </section>

    <section class="tableWrap" aria-label="الجدول">
      <table>
        <thead>
          <tr>
            <th>الفصل</th>
            <th>المبنى</th>
            <th>الصف</th>
            <th>عدد طلاب يسير</th>
            <th>بانتظار التشخيص</th>
            <th>إجمالي عدد الطلاب</th>
            <th>الحالة</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </section>

    <section class="footer" aria-label="إحصائيات أسفل الصفحة">
      <div class="card">
        <p class="miniTitle">توزيع المباني (حسب طلاب يسير)</p>
        <div class="list" id="byBuilding"></div>
      </div>

      <div class="card">
        <p class="miniTitle">توزيع الصفوف (حسب طلاب يسير)</p>
        <div class="list" id="byGrade"></div>
      </div>
    </section>

    <p class="note">
      • التلوين: إذا “عدد طلاب يسير” &gt; 0 يصير أخضر، وإذا = 0 يصير رمادي.<br>
      • الإحصائيات تُحسب من القيم الموجودة فعليًا داخل الجدول، لذلك تكون دقيقة.
    </p>

    <div class="tiny">جميع الحقوق محفوظة © <span id="y"></span> — مدرسة مكة المكرمة المتوسطة</div>
  </main>

<script>
  document.getElementById("y").textContent = new Date().getFullYear();

  // 1) توليد قائمة الفصول كما طلبت
  function buildClasses(){
    const out = [];
    for(let i=1;i<=8;i++) out.push(`${i}/1`);
    for(let i=2;i<=8;i++) out.push(`${i}/2`);
    for(let i=3;i<=8;i++) out.push(`${i}/3`);
    return out;
  }

  // 2) إنشاء صفوف افتراضية (تقدر تعدل المبنى/الصف لكل فصل)
  const DEFAULT_BUILDING = "الرئيسي";
  const DEFAULT_GRADE = "أول متوسط";

  function makeDefaultRows(){
    const classes = buildClasses();
    return classes.map(cls => ({
      id: cls,
      className: cls,
      building: DEFAULT_BUILDING,
      grade: DEFAULT_GRADE,
      yaseer: 0,
      pending: 0,
      total: 0
    }));
  }

  // 3) تخزين/قراءة البيانات
  const STORAGE_KEY = "general-yaseer-dashboard-v1";

  function loadRows(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return makeDefaultRows();
      const parsed = JSON.parse(raw);

      const base = makeDefaultRows();
      const byId = new Map(parsed.map(r => [r.id, r]));
      return base.map(r => byId.get(r.id) ? ({...r, ...byId.get(r.id)}) : r);
    }catch(e){
      return makeDefaultRows();
    }
  }

  function saveRows(rows){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));
  }

  // 4) عناصر الصفحة
  const tbody = document.getElementById("tbody");
  const statClasses = document.getElementById("statClasses");
  const statYaseer = document.getElementById("statYaseer");
  const statPending = document.getElementById("statPending");
  const statTotal = document.getElementById("statTotal");

  const filterBuilding = document.getElementById("filterBuilding");
  const filterGrade = document.getElementById("filterGrade");
  const filterHasYaseer = document.getElementById("filterHasYaseer");
  const searchBox = document.getElementById("searchBox");

  const byBuilding = document.getElementById("byBuilding");
  const byGrade = document.getElementById("byGrade");

  const btnRefresh = document.getElementById("btnRefresh");
  const btnReset = document.getElementById("btnReset");

  let rows = loadRows();

  // 5) أدوات صغيرة
  const clampInt = (v) => {
    const n = Number.parseInt(v,10);
    return Number.isFinite(n) && n >= 0 ? n : 0;
  };

  function rowStatus(r){
    return r.yaseer > 0 ? "has" : "none";
  }

  function matchesFilters(r){
    const b = filterBuilding.value;
    const g = filterGrade.value;
    const h = filterHasYaseer.value;
    const s = (searchBox.value || "").trim();

    if(b !== "all" && r.building !== b) return false;
    if(g !== "all" && r.grade !== g) return false;
    if(h !== "all" && rowStatus(r) !== h) return false;

    if(s){
      const hay = `${r.className} ${r.building} ${r.grade}`.toLowerCase();
      if(!hay.includes(s.toLowerCase())) return false;
    }
    return true;
  }

  // 6) رسم الجدول
  function renderTable(){
    tbody.innerHTML = "";
    const visible = rows.filter(matchesFilters);

    for(const r of visible){
      const tr = document.createElement("tr");
      tr.className = (r.yaseer > 0) ? "hasYaseer" : "noYaseer";

      // الفصل
      const tdClass = document.createElement("td");
      tdClass.textContent = r.className;

      // المبنى
      const tdBuilding = document.createElement("td");
      const selB = document.createElement("select");
      ["الشمالي","الجنوبي","الرئيسي"].forEach(x=>{
        const opt = document.createElement("option");
        opt.value = x;
        opt.textContent = (x === "الشمالي") ? "المبنى الشمالي" : (x === "الجنوبي") ? "المبنى الجنوبي" : "المبنى الرئيسي";
        selB.appendChild(opt);
      });
      selB.value = r.building;
      selB.onchange = () => { r.building = selB.value; saveRows(rows); updateAll(); };
      tdBuilding.appendChild(selB);

      // الصف
      const tdGrade = document.createElement("td");
      const selG = document.createElement("select");
      ["أول متوسط","ثاني متوسط","ثالث متوسط"].forEach(x=>{
        const opt = document.createElement("option");
        opt.value = x; opt.textContent = x;
        selG.appendChild(opt);
      });
      selG.value = r.grade;
      selG.onchange = () => { r.grade = selG.value; saveRows(rows); updateAll(); };
      tdGrade.appendChild(selG);

      // يسير
      const tdY = document.createElement("td");
      const inY = document.createElement("input");
      inY.type = "number"; inY.min = "0"; inY.className = "cellInput";
      inY.value = r.yaseer;
      inY.oninput = () => { r.yaseer = clampInt(inY.value); saveRows(rows); updateAll(false); };
      tdY.appendChild(inY);

      // بانتظار التشخيص
      const tdP = document.createElement("td");
      const inP = document.createElement("input");
      inP.type = "number"; inP.min = "0"; inP.className = "cellInput";
      inP.value = r.pending;
      inP.oninput = () => { r.pending = clampInt(inP.value); saveRows(rows); updateAll(false); };
      tdP.appendChild(inP);

      // إجمالي
      const tdT = document.createElement("td");
      const inT = document.createElement("input");
      inT.type = "number"; inT.min = "0"; inT.className = "cellInput";
      inT.value = r.total;
      inT.oninput = () => { r.total = clampInt(inT.value); saveRows(rows); updateAll(false); };
      tdT.appendChild(inT);

      // الحالة
      const tdS = document.createElement("td");
      const badge = document.createElement("span");
      badge.className = "badge";
      const dot = document.createElement("span");
      dot.className = "dot";
      const txt = document.createElement("span");
      txt.textContent = (r.yaseer > 0) ? "يوجد طلاب يسير" : "لا يوجد طلاب يسير";
      badge.appendChild(dot);
      badge.appendChild(txt);
      tdS.appendChild(badge);

      tr.appendChild(tdClass);
      tr.appendChild(tdBuilding);
      tr.appendChild(tdGrade);
      tr.appendChild(tdY);
      tr.appendChild(tdP);
      tr.appendChild(tdT);
      tr.appendChild(tdS);

      tbody.appendChild(tr);
    }
  }

  // 7) الإحصائيات (دقيقة)
  function renderStats(){
    const totalClasses = rows.length;
    const sumYaseer = rows.reduce((a,r)=>a + clampInt(r.yaseer), 0);
    const sumPending = rows.reduce((a,r)=>a + clampInt(r.pending), 0);
    const sumTotal = rows.reduce((a,r)=>a + clampInt(r.total), 0);

    statClasses.textContent = totalClasses;
    statYaseer.textContent = sumYaseer;
    statPending.textContent = sumPending;
    statTotal.textContent = sumTotal;

    const buildings = ["الشمالي","الجنوبي","الرئيسي"];
    const grades = ["أول متوسط","ثاني متوسط","ثالث متوسط"];

    const bAgg = Object.fromEntries(buildings.map(b=>[b,0]));
    const gAgg = Object.fromEntries(grades.map(g=>[g,0]));

    for(const r of rows){
      bAgg[r.building] = (bAgg[r.building] || 0) + clampInt(r.yaseer);
      gAgg[r.grade] = (gAgg[r.grade] || 0) + clampInt(r.yaseer);
    }

    byBuilding.innerHTML = "";
    buildings.forEach(b=>{
      const div = document.createElement("div");
      div.className = "row";
      const name = document.createElement("span");
      name.textContent = (b==="الشمالي") ? "المبنى الشمالي" : (b==="الجنوبي") ? "المبنى الجنوبي" : "المبنى الرئيسي";
      const val = document.createElement("span");
      val.textContent = bAgg[b] || 0;
      div.appendChild(name); div.appendChild(val);
      byBuilding.appendChild(div);
    });

    byGrade.innerHTML = "";
    grades.forEach(g=>{
      const div = document.createElement("div");
      div.className = "row";
      const name = document.createElement("span");
      name.textContent = g;
      const val = document.createElement("span");
      val.textContent = gAgg[g] || 0;
      div.appendChild(name); div.appendChild(val);
      byGrade.appendChild(div);
    });
  }

  function updateAll(reRenderTable=true){
    if(reRenderTable) renderTable();
    renderStats();
  }

  // أحداث الفلاتر
  [filterBuilding, filterGrade, filterHasYaseer].forEach(el=>{
    el.addEventListener("change", ()=>renderTable());
  });
  searchBox.addEventListener("input", ()=>renderTable());

  btnRefresh.addEventListener("click", ()=>updateAll(true));

  btnReset.addEventListener("click", ()=>{
    localStorage.removeItem(STORAGE_KEY);
    rows = makeDefaultRows();
    updateAll(true);
  });

  // أول تحميل
  updateAll(true);
</script>
</body>
</html>
